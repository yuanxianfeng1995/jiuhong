{"version":3,"sources":["webpack:///D:/jiuhong/components/yzhua006-update/app-update.vue?a8cd","webpack:///D:/jiuhong/components/yzhua006-update/app-update.vue?f9a9","webpack:///D:/jiuhong/components/yzhua006-update/app-update.vue?a16a","webpack:///D:/jiuhong/components/yzhua006-update/app-update.vue?1180","uni-app:///components/yzhua006-update/app-update.vue","webpack:///D:/jiuhong/components/yzhua006-update/app-update.vue?6a67","webpack:///D:/jiuhong/components/yzhua006-update/app-update.vue?bad6"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmI;AACnI;AAC8D;AACL;AACsC;;;AAG/F;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,gFAAM;AACR,EAAE,iGAAM;AACR,EAAE,0GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,6MAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAAomB,CAAgB,8nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC+CxnB,O;AACA;AACA,oBADA;AAEA;AACA;AACA;AACA,mBADA;AAEA,mBAFA,CAEA;AAFA,KADA,EAHA;;AASA,MATA,kBASA;AACA;AACA,uBADA,EACA;AACA,kBAFA,EAEA;AACA,sBAHA,EAGA;AACA,wBAJA,EAIA;AACA,oBALA,EAKA;AACA,mBANA,EAMA;AACA;AACA,cADA,EACA;AACA,mBAFA,EAEA;AACA,gBAHA,CAGA;AAHA,OAPA;AAYA,iBAZA,EAYA;AACA,uBAbA,EAaA;AACA,mBAdA,CAcA;AAdA;AAgBA,GA1BA;AA2BA,SA3BA,qBA2BA;AACA;AACA,GA7BA;AA8BA;AACA;AACA;AACA;AACA,8CADA;;AAGA,KANA,EA9BA;;AAsCA;AACA;AACA,UAFA,oBAEA;;;;;;;;;;;;;;;;;;;;AAoBA,KAtBA;;AAwBA;AACA,iBAzBA,2BAyBA;AACA;AACA;AACA,kEADA;AAEA,qBAFA;AAGA;AACA,+DADA,EAHA;;AAMA;AACA;AACA;AACA;AACA,yBADA;AAEA;AACA,0CAHA,EAGA;AACA,uCAJA;AAKA,mDALA;AAMA;AACA,qBADA;AAEA,0CAFA,EAEA;AACA,uCAHA;AAIA,mDAJA,EANA;;;;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAFA,MAEA;AACA;AACA,6BAFA,CAEA;AACA;AACA,SArCA;;AAuCA,KAlEA;AAmEA;AACA,eApEA,yBAoEA;AACA;AACA,6EAFA,CAEA;AACA;AACA,6BADA,CACA;;AAEA;AACA;AACA,uBADA;AAEA,qBAFA;AAGA,wBAHA;AAIA,uBAJA;AAKA,2CALA;;AAOA,0BAXA,CAWA;AACA,OAZA,MAYA;AACA;AACA;AACA,KAtFA;;AAwFA;AACA,eAzFA,yBAyFA;AACA;AACA;AACA;AACA,uBADA;AAEA,cAFA;AAGA,OALA,MAKA;AACA,8BADA,CACA;AACA,0BAFA,CAEA;AACA;AACA,KAnGA;AAoGA;AACA,aArGA,uBAqGA;AACA;AACA,qBADA,CACA;AACA,OAFA,MAEA;AACA,0BADA,CACA;AACA;;AAEA;AACA;AACA,0BAFA,CAEA;AACA,OAHA,MAGA;AACA;AACA,0BAFA,CAEA;AACA,OAHA,MAGA;AACA;AACA;AACA,SAFA;AAGA;AACA,KAvHA;AAwHA;AACA,gBAzHA,0BAyHA;AACA,6CADA,CACA;AACA;AACA,qBADA;;AAGA;;AAEA,OAFA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CADA,CACA;AACA;AACA;AACA;AACA;AACA,2CADA,CACA;AACA,oBAXA;;AAaA,SAhBA,MAgBA;AACA;AACA;AACA;AACA;AACA;AACA,OAvBA;AAwBA;AACA,KA3JA;;AA6JA;AACA,cA9JA,sBA8JA,IA9JA,EA8JA;AACA,6CADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA,OANA,EAMA;AACA;AACA;AACA;AACA,OAVA;AAWA,KA3KA;AA4KA;AACA,kBA7KA,0BA6KA,EA7KA,EA6KA,EA7KA,EA6KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BADA;AAEA,4BAFA;;AAIA;AACA;AACA;AACA,yBADA,EACA;AACA,mBAFA;AAGA,yBAHA,CADA,CAIA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KAxNA,EAtCA,E;;;;;;;;;;;;;AChDA;AAAA;AAAA;AAAA;AAA8nC,CAAgB,wmCAAG,EAAC,C;;;;;;;;;;;ACAlpC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/yzhua006-update/app-update.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./app-update.vue?vue&type=template&id=3f2da3cc&scoped=true&\"\nvar renderjs\nimport script from \"./app-update.vue?vue&type=script&lang=js&\"\nexport * from \"./app-update.vue?vue&type=script&lang=js&\"\nimport style0 from \"./app-update.vue?vue&type=style&index=0&id=3f2da3cc&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3f2da3cc\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/yzhua006-update/app-update.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./app-update.vue?vue&type=template&id=3f2da3cc&scoped=true&\"","var components\ntry {\n  components = {\n    uPopup: function() {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-popup/u-popup\" */ \"@/uview-ui/components/u-popup/u-popup.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 =\n    !(_vm.downstatus < 1) && !_vm.schedule\n      ? (_vm.downloadedSize / 1024 / 1024).toFixed(2)\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./app-update.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./app-update.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"wrap\">\n\t\t<u-popup v-model=\"popup_show\" :mask-close-able=\"!force\" mode=\"center\" borderRadius=\"10\">\n\t\t\t<view class=\"update-wrap\">\n\t\t\t\t<view class=\"update-content\">\n\t\t\t\t\t<view class=\"update-con-top\">\n\t\t\t\t\t\t<!-- 发现新版本 -->\n\t\t\t\t\t\t<text class=\"update-top-title\">发现新版本</text>\n\t\t\t\t\t\t<text class=\"update-top-version\">V{{update_info.version}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"uodate-content\" v-if=\"downstatus < 1\">更新内容:{{update_info.note}}</text>\n\t\t\t\t\t<text class=\"current-version\" v-if=\"downstatus < 1\">当前版本:V{{version}}</text>\n\n\t\t\t\t\t<view class=\"update-btn\" v-if=\"downstatus < 1\">\n\t\t\t\t\t\t<view class=\"btn-item\" @click=\"closeUpdate\">\n\t\t\t\t\t\t\t<!-- 残忍拒绝 -->\n\t\t\t\t\t\t\t<text class=\"item-text \">残忍拒绝</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"btn-item\" @click=\"nowUpdate\">\n\t\t\t\t\t\t\t<!-- 立即升级 -->\n\t\t\t\t\t\t\t<text class=\"item-text text-bule\">立即升级</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<!-- 下载进度 -->\n\t\t\t\t\t<view class=\"sche-wrap\" v-else>\n\t\t\t\t\t\t<!-- 更新包下载中 -->\n\t\t\t\t\t\t<text class=\"sche-wrap-text\">更新包下载中...</text>\n\t\t\t\t\t\t<view class=\"sche-bg\">\n\t\t\t\t\t\t\t<view class=\"sche-bg-jindu\" :style=\"lengthWidth\">\n\t\t\t\t\t\t\t\t<view class=\"sche-bg-round\">\n\t\t\t\t\t\t\t\t\t<text class=\"sche-bg-round-text\" v-if=\"schedule\">{{schedule}}%</text>\n\t\t\t\t\t\t\t\t\t<text class=\"sche-bg-round-text\"\n\t\t\t\t\t\t\t\t\t\tv-else>{{(downloadedSize/1024/1024 ).toFixed(2)}}M</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"updata-bg-img\"></view>\n\t\t\t\t<view class=\"updata-bg-color\"></view>\n\t\t\t</view>\n\t\t</u-popup>\n\t</view>\n\n</template>\n\n<script>\n\tlet vm;\n\texport default {\n\t\tname: \"app_update\",\n\t\t//@是否强制更新\n\t\tprops: {\n\t\t\tforce: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true, //true强制更新  false非强制更新\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tpopup_show: false, //弹窗是否显示\n\t\t\t\tplatform: \"\", //ios or android\n\t\t\t\tversion: \"1.0.0\", //当前软件版本\n\t\t\t\tneed_update: false, // 是否更新\n\t\t\t\tdowning: false, //是否下载中\n\t\t\t\tdownstatus: 0, //0未下载  1已开始 2已连接到资源  3已接收到数据  4下载完成\n\t\t\t\tupdate_info: {\n\t\t\t\t\tos: '', //设备系统\n\t\t\t\t\tversion: '', //最新版本\n\t\t\t\t\tnote: '', //升级说明\n\t\t\t\t},\n\t\t\t\tschedule: 0, //下载进度宽度\n\t\t\t\tdownloadedSize: 0, //下载大小\n\t\t\t\tviewObj: null, //原生遮罩view\n\t\t\t};\n\t\t},\n\t\tcreated() {\n\t\t\tvm = this;\n\t\t},\n\t\tcomputed: {\n\t\t\t// 下载进度计算\n\t\t\tlengthWidth: function() {\n\t\t\t\treturn {\n\t\t\t\t\twidth: vm.schedule * 480 / 100 + \"rpx\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\t// 检查更新\n\t\t\tupdate() {\n\t\t\t\t// #ifdef APP-PLUS\n\n\t\t\t\t// 获取手机系统信息\n\t\t\t\tuni.getSystemInfo({\n\t\t\t\t\tsuccess: function(res) {\n\t\t\t\t\t\tvm.platform = res.platform //ios  or android\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// 获取版本号\n\t\t\t\tplus.runtime.getProperty(plus.runtime.appid, function(inf) {\n\t\t\t\t\tvm.version = inf.version\n\t\t\t\t});\n\n\t\t\t\tconsole.log('当前版本', vm.version);\n\n\t\t\t\tvm.getUpdateInfo(); //获取更新信息\n\n\t\t\t\t// #endif\n\t\t\t},\n\n\t\t\t// 获取线上版本信息\n\t\t\tgetUpdateInfo() {\n\t\t\t\t//向后台发起请求，获取最新版本号\n\t\t\t\tuni.request({\n\t\t\t\t\turl: vm.$u.http.config.baseUrl + '/group/ptVersion/update',\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\theader: {\n\t\t\t\t\t\tAuthorization: 'Bearer' + uni.getStorageSync('token')\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t// console.log('待更新版本号',res.data.data.version)\n\t\t\t\t\t\t// 这里的返回的数据跟后台约定\n\t\t\t\t\t\tlet data = [{\n\t\t\t\t\t\t\tos: 'android',\n\t\t\t\t\t\t\t// version: '1.1.8', \n\t\t\t\t\t\t\tversion: res.data.data.version, //最新版本\n\t\t\t\t\t\t\tnote: res.data.data.content,\n\t\t\t\t\t\t\tdownload_url: res.data.data.downloadUrl,\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tos: 'ios',\n\t\t\t\t\t\t\tversion: res.data.data.version, //最新版本\n\t\t\t\t\t\t\tnote: res.data.data.content,\n\t\t\t\t\t\t\tdownload_url: res.data.data.downloadUrl,\n\t\t\t\t\t\t}];\n\n\n\t\t\t\t\t\t// 循环获取当前设备对应的更新数据\n\t\t\t\t\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\t\t\t\t\tif (vm.platform == data[i]['os']) {\n\t\t\t\t\t\t\t\tvm.update_info = data[i];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!vm.update_info.os) {\n\t\t\t\t\t\t\t// 后台未配置当前系统的升级数据\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// console.log('后台返回的当前系统的升级参数', vm.update_info);\n\t\t\t\t\t\t\tvm.checkUpdate(); ///检查是否更新\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 检查是否更新\n\t\t\tcheckUpdate() {\n\t\t\t\tvm = this;\n\t\t\t\tvm.need_update = vm.compareVersion(vm.version, vm.update_info.version); // 检查是否需要升级\n\t\t\t\tif (vm.need_update) {\n\t\t\t\t\tvm.popup_show = true; //线上版本号大于当前安装的版本号  显示升级框\n\n\t\t\t\t\t// 创建原生view用来遮罩tabbar的点击事件 (如果是没有用原生的tabbar这一步可以取消)\n\t\t\t\t\tvm.viewObj = new plus.nativeObj.View('viewObj', {\n\t\t\t\t\t\tbottom: '0px',\n\t\t\t\t\t\tleft: '0px',\n\t\t\t\t\t\theight: '50px',\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\tbackgroundColor: \"rgba(0,0,0,.6)\"\n\t\t\t\t\t});\n\t\t\t\t\tvm.viewObj.show() //显示原生遮罩\n\t\t\t\t} else {\n\t\t\t\t\tvm.popup_show = false;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// 取消更新\n\t\t\tcloseUpdate() {\n\t\t\t\tif (vm.force) {\n\t\t\t\t\t// 强制更新，取消退出app\n\t\t\t\t\tplus.os.name == \"Android\" ? plus.runtime.quit() : plus.ios.import(\"UIApplication\").sharedApplication()\n\t\t\t\t\t\t.performSelector(\n\t\t\t\t\t\t\t\"exit\");\n\t\t\t\t} else {\n\t\t\t\t\tvm.popup_show = false; //关闭升级弹窗\n\t\t\t\t\tvm.viewObj.hide() //隐藏原生遮罩\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 立即更新\n\t\t\tnowUpdate() {\n\t\t\t\tif (vm.downing) {\n\t\t\t\t\treturn false //如果正在下载就停止操作\n\t\t\t\t} else {\n\t\t\t\t\tvm.downing = true; //状态改变 正在下载中\n\t\t\t\t}\n\n\t\t\t\tif (/\\.apk$/.test(vm.update_info.download_url)) {\n\t\t\t\t\t// 如果是apk地址\n\t\t\t\t\tvm.download_wgt() // 安装包/升级包更新\n\t\t\t\t} else if (/\\.wgt$/.test(vm.update_info.download_url)) {\n\t\t\t\t\t// 如果是更新包\n\t\t\t\t\tvm.download_wgt() // 安装包/升级包更新\n\t\t\t\t} else {\n\t\t\t\t\tplus.runtime.openURL(vm.update_info.download_url, function() { //调用外部浏览器打开更新地址\n\t\t\t\t\t\tplus.nativeUI.toast(\"打开错误\");\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 下载升级资源包\n\t\t\tdownload_wgt() {\n\t\t\t\tplus.nativeUI.showWaiting(\"下载更新文件...\"); //下载更新文件...\n\t\t\t\tlet options = {\n\t\t\t\t\tmethod: \"get\"\n\t\t\t\t};\n\t\t\t\tlet dtask = plus.downloader.createDownload(vm.update_info.download_url, options, function(d, status) {\n\n\t\t\t\t});\n\n\t\t\t\tdtask.addEventListener(\"statechanged\", function(task, status) {\n\t\t\t\t\tif (status === null) {} else if (status == 200) {\n\t\t\t\t\t\t//在这里打印会不停的执行，请注意，正式上线切记不要在这里打印东西///////////////////////////////////////////////////\n\t\t\t\t\t\tvm.downstatus = task.state;\n\t\t\t\t\t\tswitch (task.state) {\n\t\t\t\t\t\t\tcase 3: // 已接收到数据  \n\t\t\t\t\t\t\t\tvm.downloadedSize = task.downloadedSize;\n\t\t\t\t\t\t\t\tlet totalSize = 0;\n\t\t\t\t\t\t\t\tif (task.totalSize) {\n\t\t\t\t\t\t\t\t\ttotalSize = task.totalSize //服务器须返回正确的content-length才会有长度\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvm.schedule = parseInt(100 * task.downloadedSize / totalSize);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\tvm.installWgt(task.filename); // 安装wgt包  \n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tplus.nativeUI.closeWaiting();\n\t\t\t\t\t\tplus.nativeUI.toast(\"下载出错\");\n\t\t\t\t\t\tvm.downing = false;\n\t\t\t\t\t\tvm.downstatus = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdtask.start();\n\t\t\t},\n\n\t\t\t// 安装文件\n\t\t\tinstallWgt(path) {\n\t\t\t\tplus.nativeUI.showWaiting(\"安装更新文件...\"); //安装更新文件...\n\t\t\t\tplus.runtime.install(path, {}, function() {\n\t\t\t\t\tplus.nativeUI.closeWaiting();\n\t\t\t\t\t// 应用资源下载完成！\n\t\t\t\t\tplus.nativeUI.alert(\"应用资源下载完成！\", function() {\n\t\t\t\t\t\tplus.runtime.restart();\n\t\t\t\t\t});\n\t\t\t\t}, function(e) {\n\t\t\t\t\tplus.nativeUI.closeWaiting();\n\t\t\t\t\t// 安装更新文件失败\n\t\t\t\t\tplus.nativeUI.alert(\"安装更新文件失败[\" + e.code + \"]：\" + e.message);\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 对比版本号\n\t\t\tcompareVersion(ov, nv) {\n\t\t\t\tif (!ov || !nv || ov == \"\" || nv == \"\") {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t//新的算法\n\t\t\t\t// console.log(ov, nv)\n\t\t\t\tlet newVersion = parseInt(nv.replace(/\\./g, ''))\n\t\t\t\tlet nowVersion = parseInt(ov.replace(/\\./g, ''))\n\t\t\t\tconsole.log('版本比较1', newVersion, nowVersion)\n\t\t\t\tif (newVersion >= 111) {\n\t\t\t\t\tconsole.log('切换更新版本', newVersion)\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\tif (newVersion > nowVersion) {\n\t\t\t\t\tconsole.log('需要更新1')\n\t\t\t\t\treturn true\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('不需要更新1')\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn\n\t\t\t\t//老的算法\n\t\t\t\tlet b = false,\n\t\t\t\t\tova = ov.split(\".\", 4),\n\t\t\t\t\tnva = nv.split(\".\", 4);\n\n\t\t\t\tconsole.log('版本比较', ova, nva)\n\t\t\t\tfor (let i = 0; i < ova.length && i < nva.length; i++) {\n\t\t\t\t\tlet so = ova[i],\n\t\t\t\t\t\tno = parseInt(so), //上一版本\n\t\t\t\t\t\tsn = nva[i],\n\t\t\t\t\t\tnn = parseInt(sn); //下一版本\n\t\t\t\t\tif (nn > no || sn.length > so.length) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else if (nn < no) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (nva.length > ova.length && 0 == nv.indexOf(ov)) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\n\t.wrap {\n\n\t\t/deep/ .u-mode-center-box {\n\t\t\tbackground: none;\n\t\t}\n\t}\n\n\t.update-wrap {\n\t\twidth: 580rpx;\n\t\theight: 500rpx;\n\t\tborder-radius: 10rpx;\n\t\tpadding-bottom: 0px;\n\t\tposition: relative;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\n\t\t.updata-bg-img {\n\t\t\tposition: absolute;\n\t\t\ttop: 0vw;\n\t\t\tleft: 0px;\n\t\t\twidth: 580rpx;\n\t\t\theight: 440rpx;\n\t\t\tbackground: url(./images/update-img.png) no-repeat;\n\t\t\tbackground-size: 100% 100%;\n\t\t\tz-index: 1;\n\t\t}\n\n\t\t.updata-bg-color {\n\t\t\tposition: absolute;\n\t\t\twidth: 580rpx;\n\t\t\ttop: 10vw;\n\t\t\theight: calc(100% - 10vw);\n\t\t\tbackground-color: #ffffff;\n\t\t\tz-index: 0;\n\n\t\t}\n\n\t\t.update-content {\n\t\t\theight: 100%;\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t}\n\n\t\t.update-content {\n\t\t\tposition: relative;\n\t\t\tz-index: 2;\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t}\n\n\t\t.update-con-top {\n\t\t\tposition: relative;\n\t\t\tpadding: 70rpx 50rpx;\n\t\t\tmargin-top: auto;\n\t\t}\n\n\n\t\t.update-btn {\n\t\t\twidth: 100%;\n\t\t\theight: 80rpx;\n\t\t\tpadding: 0px 50rpx;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tborder-top: 1px solid #e7e7e7;\n\t\t\tbackground-color: #fff;\n\t\t\tborder-bottom-left-radius: 30rpx;\n\t\t\tborder-bottom-right-radius: 30rpx;\n\n\t\t\t.btn-item {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tflex: 1;\n\n\t\t\t\t.item-text {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\tcolor: #666;\n\t\t\t\t}\n\n\t\t\t\t.text-bule {\n\t\t\t\t\tcolor: #045FCF;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.btn-item:first-child {\n\t\t\t\tborder-right: 1px solid #e7e7e7\n\t\t\t}\n\t\t}\n\n\t\t.update-top-title {\n\t\t\tcolor: #fff;\n\t\t\tfont-size: 34rpx;\n\t\t\tfont-weight: bold;\n\t\t}\n\n\t\t.update-top-version {\n\t\t\tcolor: #fff;\n\t\t\tfont-size: 28rpx;\n\t\t\tmargin-top: 10rpx;\n\t\t}\n\n\t\t.uodate-content {\n\t\t\tcolor: #333;\n\t\t\tfont-size: 30rpx;\n\t\t\tpadding: 0px 50rpx;\n\t\t\tmargin-top: 100rpx;\n\t\t}\n\n\t\t.current-version {\n\t\t\ttext-align: center;\n\t\t\tmargin-top: 20rpx;\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #666;\n\t\t\tmargin-bottom: 16rpx;\n\t\t}\n\t}\n\n\t.sche-wrap {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: flex-end;\n\t\tpadding: 0px 50rpx 40rpx;\n\t\theight: 100rpx;\n\t\tborder-bottom-left-radius: 30rpx;\n\t\tborder-bottom-right-radius: 30rpx;\n\t\tflex: 1;\n\n\t\t.sche-wrap-text {\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #666;\n\t\t\tmargin-bottom: 20rpx;\n\t\t}\n\n\t\t.sche-bg {\n\t\t\tposition: relative;\n\t\t\tbackground-color: #ccc;\n\t\t\theight: 20rpx;\n\t\t\tborder-radius: 100px;\n\t\t\twidth: 480rpx;\n\t\t\tmargin-bottom: 30rpx;\n\t\t}\n\n\t\t.sche-bg-jindu {\n\t\t\tposition: absolute;\n\t\t\tleft: 0px;\n\t\t\ttop: 0px;\n\t\t\theight: 20rpx;\n\t\t\tbackground-color: #5775e7;\n\t\t\tborder-radius: 100px;\n\n\t\t\t.sche-bg-round {\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 100%;\n\t\t\t\theight: 24rpx;\n\t\t\t\twidth: 24rpx;\n\t\t\t\tbackground-color: #fff;\n\t\t\t\tborder-color: #fff;\n\t\t\t\tborder-style: solid;\n\t\t\t\tborder-width: 10px;\n\t\t\t\tborder-radius: 100px;\n\t\t\t\ttransform: translateX(-20rpx) translateY(-10rpx);\n\n\t\t\t\t.sche-bg-round-text {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\ttop: 10rpx;\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tcolor: #5775e7;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n</style>\n","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./app-update.vue?vue&type=style&index=0&id=3f2da3cc&lang=scss&scoped=true&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./app-update.vue?vue&type=style&index=0&id=3f2da3cc&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1626182057823\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}